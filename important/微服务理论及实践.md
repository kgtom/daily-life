---


---

<h2 id="一、理论---康威定律">一、理论—康威定律</h2>
<h4 id="section">1.</h4>
<p>在康威的这篇文章中，最有名的一句话就是：</p>
<blockquote>
<p>Organizations which design systems are constrained to produce designs which are copies of the communication structures of these organizations. - Melvin Conway(1967)</p>
</blockquote>
<p>中文直译大概的意思就是：设计系统的组织，其产生的设计等同于组织之内、组织之间的沟通结构。看看下面的图片（来源于互联网，侵删），再想想Apple的产品、微软的产品设计，就能形象生动的理解这句话。<br>
<img src="http://img2.tbcdn.cn/L1/461/1/74ab78cb5db601e5db68adf61e6dc58f437df4e0" alt="screenshot" title="screenshot"></p>
<p>用通俗的说法就是：组织形式等同系统设计。</p>
<h3 id="康威定律如何解释微服务的合理性">康威定律如何解释微服务的合理性</h3>
<p>了解了康威定律是什么，再来看看他如何在半个世纪前就奠定了微服务架构的理论基础。</p>
<ul>
<li>人与人的沟通是非常复杂的，一个人的沟通精力是有限的，所以当问题太复杂需要很多人解决的时候，我们需要做拆分组织来达成对沟通效率的管理</li>
<li>组织内人与人的沟通方式决定了他们参与的系统设计，管理者可以通过不同的拆分方式带来不同的团队间沟通方式，从而影响系统设计</li>
<li>如果子系统是内聚的，和外部的沟通边界是明确的，能降低沟通成本，对应的设计也会更合理高效</li>
<li>复杂的系统需要通过容错弹性的方式持续优化，不要指望一个大而全的设计或架构，好的架构和设计都是慢慢迭代出来的</li>
</ul>
<p>带来的具体的实践建议是：</p>
<ul>
<li>我们要用一切手段提升沟通效率，比如slack，github，wiki。能2个人讲清楚的事情，就不要拉更多人，每个人每个系统都有明确的分工，出了问题知道马上找谁，避免踢皮球的问题。</li>
<li>通过 最小可用产品（Minimum Viable Product， MVP）理念，做出最小可用产品，尽快丢给用户试用，快速获取客户反馈，在此基础上不断迭代和演化架构和产品的方式来设计系统，通过不断的迭代来验证优化，系统应该是弹性设计的。</li>
<li>你想要什么样的系统设计，就架构什么样的团队，能扁平化就扁平化。最好按业务来划分团队，这样能让团队自然的自治内聚，明确的业务边界会减少和外部的沟通成本，每个小团队都对自己的模块的整个生命周期负责，没有边界不清，没有无效的扯皮，inter-operate, not integrate。</li>
<li>做小而美的团队，人多会带来沟通的成本，让效率下降。亚马逊的Bezos有个逗趣的比喻，如果2个披萨不够一个团队吃的，那么这个团队就太大了。事实上一般一个互联网公司小产品的团队差不多就是7，8人左右（包含前后端测试交互用研等，可能身兼数职）。</li>
</ul>
<p>再对应下衡量微服务的标准，我们很容易会发现他们之间的密切关系：</p>
<ul>
<li>分布式服务组成的系统</li>
<li>按照业务而不是技术来划分组织</li>
<li>做有生命的产品而不是项目</li>
<li>Smart endpoints and dumb pipes（我的理解是强服务个体和弱通信）</li>
<li>自动化运维（DevOps）</li>
<li>容错</li>
<li>快速演化</li>
</ul>
<h2 id="二、实践">二、实践</h2>
<h2 id="三、总结">三、总结</h2>
<h4 id="组织沟通方式决定系统设计">1.组织沟通方式决定系统设计</h4>
<p>《人月神话》中最著名的一句话就是</p>
<blockquote>
<p>Adding manpower to a late software project makes it later --Fred Brooks, (1975)</p>
</blockquote>
<p>Boss们都听到了吗？为了赶进度加程序员就像用水去灭油锅里的火一样（无奈大家还是前赴后继）。</p>
<p>为什么？人月神话也给出了很简洁的答案：沟通成本 = n(n-1)/2，沟通成本随着项目或者组织的人员增加呈指数级增长。是的，项目管理这个算法的复杂度是O(n^2)。举个例子</p>
<ul>
<li>5个人的项目组，需要沟通的渠道是 5*(5–1)/2 = 10</li>
<li>15个人的项目组，需要沟通的渠道是15*(15–1)/2 = 105</li>
<li>50个人的项目组，需要沟通的渠道是50*(50–1)/2 = 1,225</li>
<li>150个人的项目组，需要沟通的渠道是150*(150–1)/2 = 11,175</li>
</ul>
<p>所以知道为什么互联网创业公司都这么小了吧，必须小啊，不然等CEO和所有人讲一遍创业的想法后，风投的钱都烧完了。</p>
<h4 id="一口气吃不成胖子，先搞定能搞定的">2.一口气吃不成胖子，先搞定能搞定的</h4>
<p>据说Eric被一家航空公司请去做安全咨询顾问，复杂保证飞机飞行系统的稳定性和安全性。Eric认为做到安全有两种方式：</p>
<ul>
<li>常规的安全指的是尽可能多的发现并消除错误的部分，达到绝对安全，这是理想。</li>
<li>另一种则是弹性安全，即使发生错误，只要及时恢复，也能正常工作，这是现实。</li>
</ul>
<p>对于飞机这样的复杂系统，再牛逼的人也无法考虑到漏洞的方方面面，所以Eric建议放弃打造完美系统的想法，而是通过不断的试飞，发现问题，确保问题发生时，系统能自动复原即可，而不追求飞行系统的绝对正确和安全。</p>
<p>这和互联网公司维护的分布式系统的弹性设计也是一个道理。对于一个分布式系统，我们几乎永远不可能找到并修复所有的bug，单元测试覆盖1000%也没有用，错误流淌在分布式系统的血液里。解决方法不是消灭这些问题，而是容忍这些问题，在问题发生时，能自动回复，微服务组成的系统，每一个微服务都可能挂掉，这是常态 ，我们只有有足够的冗余和备份即可。即所谓的 <strong>弹性设计（Resilience）</strong> 或者叫高可用设计（High Availability）。</p>
<h4 id="种瓜得瓜，做独立自治的字系统减少沟通成本">3.种瓜得瓜，做独立自治的字系统减少沟通成本</h4>
<p>简单的说，你想要什么样的系统，就搭建什么样的团队。如果你的团队分成前端团队，Java后台开发团队，DBA团队，运维团队，你的系统就会长成下面的样子：<br>
<img src="http://img4.tbcdn.cn/L1/461/1/f4c2d4a8f8390ca6be19b54a524c8272aced3e34" alt="screenshot" title="screenshot"></p>
<p>相反，如果你的系统是按照业务边界划分的，大家按照一个业务目标去把自己的模块做出小系统，小产品的话，你的大系统就会长成下面的样子，即微服务的架构<br>
<img src="http://img3.tbcdn.cn/L1/461/1/c827db7a12d730140d4c0e6947535e168902a73e" alt="screenshot" title="screenshot"></p>
<h4 id="合久必分，分而治之">4.合久必分，分而治之</h4>
<p>微服务的理念团队间应该是  <strong>inter-operate, not integrate</strong>  。inter-operate是定义好系统的边界和接口，在一个团队内全栈，让团队自治，原因就是因为如果团队按照这样的方式组建，将沟通的成本维持在系统内部，每个子系统就会更加内聚，彼此的依赖耦合能变弱，跨系统的沟通成本也就能降低。<br>
一个大的组织因为沟通成本/管理问题，总为被拆分成一个个小团队。</p>
<ul>
<li>创业的想法太好了，反正风投钱多，多招点程序猿</li>
<li>人多管不过来啊，找几个经理帮我管，我管经理</li>
<li>最后，  <strong>康威定律</strong>  告诉我们组织沟通的方式会在系统设计上有所表达，每个经理都被赋予一定的职责去做大系统的某一小部分，他们和大系统便有了沟通的边界，所以大的系统也会因此被拆分成一个个小团队负责的小系统（微服务是一种好的模式）</li>
</ul>
<blockquote>
<p>reference:<br>
<a href="https://yq.aliyun.com/articles/8611">微服务架构的理论基础 - 康威定律</a><br>
<a href="https://www.toutiao.com/i6208902553864241665/">58同城沈剑：好的架构源于不停地衍变，而非设计</a><br>
<a href="https://www.jianshu.com/p/410250e006cb">宜人贷系统架构——高并发下的进化之路</a></p>
</blockquote>

