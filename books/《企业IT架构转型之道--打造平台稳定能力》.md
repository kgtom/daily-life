---


---

<h2 id="打造平台稳定能力">打造平台稳定能力</h2>
<h3 id="前言">前言</h3>
<p>本章主要从共享服务中台的角度，如何打造平台稳定性，主要从以下几个方面：</p>
<ul>
<li>限流和降级</li>
<li>流量调度</li>
<li>业务开关</li>
<li>容量压测和评估</li>
<li>全链路压测平台</li>
<li>业务一致性平台</li>
</ul>
<h3 id="一、限流和降级">一、限流和降级</h3>
<p><strong>限流</strong>作用相当于电路上的保险丝，当过载的时候掐掉一部分流量，让系统有能力集中资源以较快的速度处理平台能力范围的业务。<br>
<strong>场景</strong>：</p>
<ul>
<li>
<ol>
<li>一个核心api，会有很多应用调用，如果对服务的调用不加限制的使用，会造成请求占满，响应超时，服务故障。</li>
</ol>
</li>
<li>
<ol start="2">
<li>大促活动场景，预估100w人参与，结果1000w人瞬间涌来，大量资源抢占和服务器上下文切换<br>
<strong>做法</strong>最关键的不是监控cup、内存、IO是否过载(因为很多情况下系统本身的处理能力跟操作系统资源的使用情况没有一个很清晰的定位)，而是找到最合适的QPS.</li>
</ol>
</li>
<li>
<p>前端：Nginx上扩展组件，实现接入层限流，通过域名类限流、cookie限流、黑名单方式</p>
</li>
<li>
<p>后端：</p>
</li>
</ul>
<ul>
<li>一种action拦截器，计算目前线程或者qps与所设置最大数比较，如果大于返回异常信息。这种做法简单，一个应用可以这么写，100应用要是写100拦截器就算了吧，另外缺少监控平台，不能全局掌控。</li>
<li>另一种Sentine 哨兵平台实现 授权、限流、降级(非核心功能暂停)、监控</li>
</ul>
<h3 id="二、流量调度">二、流量调度</h3>
<p><strong>背景</strong></p>
<ul>
<li>分布式服务环境调用局部问题会被放大到整个链路，在分布式环境中，硬件、软件、网络等导致机器的实时服务能力有所差异。一次网络抖动或者cpu超配都会引起。</li>
</ul>
<p><strong>实现原理</strong><br>
通过秒级获取服务器运行指标及业务指标，通过流量平台设置决策算法和规则，满足条件的服务器进行下线或者降级操作。</p>
<h3 id="三、业务开关">三、业务开关</h3>
<p><strong>做法</strong>将每一个系统的业务开关(配置文件值)统一到集团层面，建立业务开关平台统一处理。<br>
<strong>作用</strong> 在大促、秒杀、应用异常时，业务开关服务起到降级的作用。</p>
<h3 id="四、容量压测及评估规划">四、容量压测及评估规划</h3>
<blockquote>
<p>reference:<br>
《企业IT架构转型之道》</p>
</blockquote>

