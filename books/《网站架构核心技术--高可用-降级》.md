## 学习大纲
* [一、降级预案](#1)
* [二、自动开关降级](#2)
* [三、人工开个降级](#3)
* [四、读服务降级](#4)
* [五、写服务降级](#5)
* [六、多降级](#6)

## <span id="1">一、降级预案</span>

降级目的：保证核心服务可用。降级之前需要梳理系统是否可以丢卒保帅。哪些必须誓死保护，哪些可降级。可以参考日志级别设置预案。
* 一般
* 警告
* 错误
* 严重错误

## <span id="2">二、自动开关降级</span>

自动降级是根据系统负载、资源使用情况、SLA等指标进行降级。
### 1.超时降级
db连接、http请求、rpc请求超时时，自动触发降级。
### 2.超过次数降级
条用外部机票政策服务，当失败调用次数达到一定阈值时，自动降级，然后开启一个goroutine去检测服务是否可用，决定降级服务是否恢复。
### 3.故障降级
比如：rpc(网络、DNS、HTTP、缓存)挂了,可以直接降级，降级后返回默认值。
缓存 返回默认之前存储数据；http 返回兜底数据。
### 4.限流降级
比如：秒杀、抢购时，当超过限流请求阈值后，可以采取降级方案：排队页面、无货、错误页面(稍后重试)。
## <span id="3">三、人工开个降级</span>
人工降级场景：
* 配置文件：db、redis 参数配置
* 根据某个value值，然后决定是否降级
* 新上线功能，配置开关，新旧版本切换
* 暂时需要屏蔽功能，配置开关
## <span id="4">四、读服务降级</span> 
场景：对读一致性不高的场景，读动态的转换到读缓存、多静态资源。例如某个商品详情页的加载。
## <span id="5">五、写服务降级</span> 
场景：
* 1.秒杀抢购，下单后库存只更新 Cache,然后异步更新db。
* 2.用户评价，同步改成异步，评价按钮一定比例开放。
## <span id="6">六、多级降级</span> 
* 1.页面js降级开关：通过js脚步控制页面按钮显示或者功能呈现
* 2.接入层降级开关：设置请求入口开关，变量大流量打到后端。
* 3.应用层降级开关：控制业务的开关。
