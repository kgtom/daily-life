---


---

<h2 id="打造数字化运营能力">打造数字化运营能力</h2>
<h3 id="一、背景">一、背景</h3>
<p><strong>主要是业务服务化带来了问题，导致服务之间调用关系异常复杂，出现问题，难以定位。从研发人员及架构师两个角度看问题</strong></p>
<p><strong>研发人员</strong>定位问题 必须要知道自己服务业务场景及上下文，即涉及到两个问题：</p>
<ul>
<li>我的服务在什么链路下被调用，调用场景和数据是否可以？</li>
<li>目前服务调用趋势怎样？瞬间产生峰值多少？是否到达服务能力的最高水平</li>
</ul>
<p><strong>业务架构师</strong>与技术人员平滑沟通，也有足够的业务敏感度和精深理解的综合人才。他最关心问题是什么？</p>
<ul>
<li>当前业务流程设计中，我依赖了哪些应用、哪些服务？</li>
<li>哪些服务是最核心的？如果出错了，会有什么影i响？</li>
<li>一次业务请求时间主要花费在哪里？是服务还是db问题，需要定位清晰</li>
<li>我所负责的业务联链路中，过去一段时间哪些服务出错率比较高？还是服务是业务链路处理的瓶颈？</li>
</ul>
<h3 id="二、解决方案---分布式服务跟踪系统分布式日志处理平台">二、解决方案—分布式服务跟踪系统(分布式日志处理平台)</h3>
<p><strong>思路</strong>：通过服务调用链各服务处理节点生成相应的日志信息，每一个url请求生成唯一的TraceID。包括(服务调用、数据库、缓存、消息服务等)</p>
<p>举例：订单创建成功—异步 mq通知(支付、库存、物流、评价等)同时执行任务，形成一对多服务调用场景。也就形成了类似于树形的调用关系。</p>
<p><strong>TLog</strong> 分布式日志处理平台，重点在于配置合适日志采样率。较低采样率可能会错过重要消息，较高的则增加了系统网络和磁盘IO性能。所以根据业务的访问量和服务调用的频率调整合适的日志采样率。</p>
<h3 id="三、典型的业务场景">三、典型的业务场景</h3>
<ul>
<li>服务实时监控，除了对基础层面(cpu、内存、网络、磁盘IO等),还需要对服务监控，在Http 入口处设置日志埋点。</li>
<li><strong>研发人员角度</strong>服务调用链跟踪：业务链路数据的实时监控。包括 应用名、ip、服务类型(操作db 还是操作缓存)、状态(OK、TIIMEOUT、NOTEXSIT)、数据大小、服务(方法)名称</li>
<li><strong>业务架构师角度</strong> 服务调用链分析：服务运行数据的统计和分析，有助于事实数据支持业务决策优化。包括服务嵌套层数、服务(方法)名称、QPS、峰值、调用次数、平均耗时、本地耗时、依赖度(强依赖、弱依赖)、标记</li>
<li>业务实时监控：通过发掘数据的最高时效价值，为业务增长进行保驾护航的同时，帮助业务寻求潜在的增长点。比如：实时交易金额、移动端比例、top10热销产品、卖家等，掌握这些数据可以做精准化营销工作，例如某个地区移动端比例少，可以投放一下红包，例如 top 热销机票、出发地，可以申请更多仓位。<br>
<strong>如何挖掘数据的时效价值呢？</strong>
<ul>
<li>传统方式：一种直接访问线上db，因为涉及大量统计、查询、计算，对db压力很大，另一种同步db，然后在新db中统计，数据量大的时候，同步需要一定时间(分钟级)</li>
<li>互联网解决方案：分布式日志平台，将各个业务事件发生时输出到日志系统，然后将数据保存到后端db，再提供api供前端显示(秒级)</li>
</ul>
</li>
</ul>
<h2 id="下一章-打造平台稳定能力">下一章 打造平台稳定能力</h2>
<blockquote>
<p>reference:<br>
《企业IT架构转型之道》</p>
</blockquote>

